<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
"http://www.w3.org/TR/html4/loose.dtd">
<html>
	<head>
		<script language="JScript" type="text/jscript" src="activateActiveX_onload.js"></script>
		<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
		<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-giJF6kkoqNQ00vy+HMDP7azOuL0xtbfIcaT9wjKHr8RbDVddVHyTfAAsrekwKmP1" crossorigin="anonymous">
		<title>Bill Giacalone Catalogue</title>
	</head>

	<body>
		<div class="container">
			<h1>Search for Paintings</h1>

			<h3>Category</h3>
			<div>
				<button class="btn btn-secondary" onclick="selectCat('name', 'text')">Name</button>
				<button class="btn btn-secondary" onclick="selectCat('medium', 'dropdown')">Medium</button>
				<button class="btn btn-secondary" onclick="selectCat('year', 'dropdown')">Year</button>
				<button class="btn btn-secondary" onclick="selectCat('theme', 'dropdown')">Theme</button>
				<button class="btn btn-secondary" onclick="selectCat('paint_type', 'dropdown')">Paint</button>
				<button class="btn btn-secondary" onclick="selectCat('height', 'text')">Height</button>
				<button class="btn btn-secondary" onclick="selectCat('width', 'text')">Width</button>
				<button class="btn btn-secondary" onclick="selectCat('catalognumber', 'text')">Code</button>
				<button class="btn btn-secondary" onclick="selectCat('price', 'text')">Price</button>
			</div>

			<h3 id="tags-header">Tags</h3>
			<div id="tags"></div>
			<br>

			<!-- home button  -->
			<a href="bgcatalog.html" class="btn btn-primary">Home</a>

			<script>
				var tags = document.getElementById("tags");
				var tagsHeader = document.getElementById("tags-header");

				// Called when category is selected
				function selectCat(category, fieldType) {
	        // Display a free text field if required
	        if (fieldType == "text") {
	            tagsHeader.innerHTML = "Search";
	            tags.innerHTML = "";

							var form = document.createElement("form");
							form.onsubmit = function(event) {
								event.preventDefault();
								var formData = new FormData();
								formData.append("fields", category);
								formData.append("term", event.target.childNodes[1].value);
								ajaxPostFormPage("bgquery.php", formData);
							};
							tags.appendChild(form);

	            var inputField = document.createElement("input");
	            inputField.setAttribute("name", "term");
							inputField.className = "form-control";
							form.appendChild(inputField);

							var submitButton = document.createElement("input");
							submitButton.innerHTML = "Submit";
							submitButton.className = "btn btn-primary";
							submitButton.setAttribute("type", "submit");
							form.appendChild(submitButton);
	        }
	        else {
	            tagsHeader.innerHTML = "Tags";
	            // Get tags
	            var formData = new FormData();
	            formData.append("fields", category);
	            ajaxPostForm("bgrequesttags.php", formData)
	                .then(data => {
	                    tags.innerHTML = "";
	                    for (var tag of data.tags) {
	                        var tagButton = document.createElement("button");
	                        tagButton.innerHTML = tag;
	                        tagButton.className = "btn btn-secondary";
	                        tagButton.setAttribute("data-tag", tag);
	                        tagButton.onclick = function(event) {
	                            var formDataTag = new FormData();
	                            formDataTag.append("fields", category);
	                            formDataTag.append("term", event.target.getAttribute("data-tag"));
	                            ajaxPostFormPage("bgquery.php", formDataTag);
	                        };
	                        tags.appendChild(tagButton);
	                    }
	                }
	            );
	        }
				}

				// GET helper function
				async function ajaxGet(url) {
					const response = await fetch(url, {
				    method: "GET",
				    mode: "cors",
						redirect: "follow",
				  });
				  return response.json();
				}

				// POST helper function for sending JSON
				async function ajaxPostJSON(url, data = {}) {
					const response = await fetch(url, {
				    method: "POST",
				    mode: "cors",
						headers: {
							"Content-Type": "application/json"
						},
						redirect: "follow",
				    body: JSON.stringify(data)
				  });
				  return response.json();
				}

				// POST helper function for sending form data
				async function ajaxPostForm(url, data) {
					const response = await fetch(url, {
				    method: "POST",
				    mode: "cors",
						redirect: "follow",
				    body: data
				  });
				  return response.json();
				}

				// POST helper function for loading a page with form params
				function ajaxPostFormPage(url, data) {
					var form = document.createElement("form");
					form.setAttribute("method", "POST");
					form.setAttribute("action", url);
					for (var pair of data.entries()) {
						var field = document.createElement("input");
						field.setAttribute("type", "text");
						field.setAttribute("name", pair[0]);
						field.value = pair[1];
						form.appendChild(field);
					}
					document.body.appendChild(form);
					form.submit();
					document.body.removeChild(form);
				}
			</script>
			<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta1/dist/js/bootstrap.bundle.min.js" integrity="sha384-ygbV9kiqUc6oa4msXn9868pTtWMgiQaeYH7/t7LECLbyPA2x65Kgf80OJFdroafW" crossorigin="anonymous"></script>
		</div>
	</body>
</html>
